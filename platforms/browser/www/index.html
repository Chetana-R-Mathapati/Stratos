<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; media-src *; img-src * data:">
        <meta name="theme-color" content="#000000">
        <link rel="manifest" href="manifest.json">
        <title>Stratos: Vision to Venture</title>
        
        <!-- CSS -->
        <link rel="stylesheet" href="css/mobile-styles.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        
        <!-- Scripts -->
        <script type="text/javascript" src="cordova.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js')
                        .then((registration) => {
                            console.log('ServiceWorker registration successful');
                        })
                        .catch((err) => {
                            console.log('ServiceWorker registration failed: ', err);
                        });
                });
            }
        </script>
        <style>
            .test-update {
                background: #4CAF50;
                color: white;
                padding: 10px;
                text-align: center;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 9999;
            }
        </style>
    </head>
    <body>
        <div class="test-update">
            Live Update Test - If you see this message, updates are working!
        </div>
        <div class="app-container">
            <!-- Content Area -->
            <div class="content-area">
                <!-- Welcome Section -->
                <section class="welcome-section">
                    <h1 class="text-center" style="color: #1a237e; margin-top: 20px;">Welcome to<br>Stratos</h1>
                    <p class="text-center mb-4">Your journey from vision to venture starts here.</p>
                </section>

                <!-- Video Section -->
                <section class="video-section mb-4">
                    <div class="video-container">
                        <video autoplay muted loop playsinline style="width: 100%; border-radius: 15px;">
                            <source src="screen-recording.mp4" type="video/mp4">
                        </video>
                    </div>
                </section>

                <!-- Success Stories -->
                <section class="success-stories mb-4">
                    <h4 class="section-title">Success Stories</h4>
                    <div id="successCarousel" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <div class="story-card">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFvgShDSHxS9JXboiHtc7BXWjisJ_hvG_Dhw&s" alt="Nykaa">
                                    <div class="card-content">
                                        <h5>Nykaa</h5>
                                        <p>Started as a beauty product website, now a top lifestyle platform.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="carousel-item">
                                <div class="story-card">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSc-PgzVLHSfnGP0C7NVzofxPmtSypyZdZBw&s" alt="Paytm">
                                    <div class="card-content">
                                        <h5>Paytm</h5>
                                        <p>From mobile payments to India's leading fintech platform.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a class="carousel-control-prev" href="#successCarousel" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </a>
                        <a class="carousel-control-next" href="#successCarousel" role="button" data-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </a>
                    </div>
                </section>

                <!-- Startup Funding Trends -->
                <section class="funding-trends mb-4">
                    <h4 class="section-title">Startup Funding Trends</h4>
                    <div class="chart-container">
                        <canvas id="fundingChart"></canvas>
                    </div>
                </section>

                <!-- Mentor Network -->
                <section class="mentor-network mb-4">
                    <h4 class="section-title">Our Mentor Network</h4>
                    <div class="mentor-grid">
                        <div class="mentor-card">
                            <div class="mentor-info">
                                <h6>Dr. Neha Sharma</h6>
                                <p>Startup Strategist</p>
                            </div>
                        </div>
                        <div class="mentor-card">
                            <div class="mentor-info">
                                <h6>Amit Raj</h6>
                                <p>Tech Advisor</p>
                            </div>
                        </div>
                        <div class="mentor-card">
                            <div class="mentor-info">
                                <h6>Sara Verma</h6>
                                <p>Design Coach</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Impact Metrics -->
                <section class="impact-metrics mb-5">
                    <h4 class="section-title">Our Impact</h4>
                    <div class="impact-grid">
                        <div class="impact-item">
                            <div class="impact-bar" style="height: 200px; background-color: #4CAF50;"></div>
                            <div class="impact-label">120+ Ideas</div>
                        </div>
                        <div class="impact-item">
                            <div class="impact-bar" style="height: 150px; background-color: #2196F3;"></div>
                            <div class="impact-label">45 Mentors</div>
                        </div>
                        <div class="impact-item">
                            <div class="impact-bar" style="height: 180px; background-color: #FFA500;"></div>
                            <div class="impact-label">18 Startups</div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Fixed Bottom Navigation -->
            <nav class="mobile-nav">
                <a href="index.html" class="mobile-nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="idea-incubation.html" class="mobile-nav-item">
                    <i class="fas fa-lightbulb"></i>
                    <span>Ideas</span>
                </a>
                <a href="mentor.html" class="mobile-nav-item">
                    <i class="fas fa-users"></i>
                    <span>Mentors</span>
                </a>
                <a href="funds.html" class="mobile-nav-item">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span>Investors</span>
                </a>
                <a href="javascript:void(0);" class="mobile-nav-item" onclick="showMoreMenu()">
                    <i class="fas fa-ellipsis-h"></i>
                    <span>More</span>
                </a>
            </nav>
        </div>

        <!-- More Menu Modal -->
        <div class="modal" id="moreMenu" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">More Options</h5>
                        <button type="button" class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="list-group">
                            <a href="industry.html" class="list-group-item list-group-item-action">
                                <i class="fas fa-industry"></i> Industry Insights
                            </a>
                            <a href="promo.html" class="list-group-item list-group-item-action">
                                <i class="fas fa-ad"></i> Promo Zone
                            </a>
                            <a href="join.html" class="list-group-item list-group-item-action">
                                <i class="fas fa-handshake"></i> Collab
                            </a>
                            <a href="tax.html" class="list-group-item list-group-item-action">
                                <i class="fas fa-calculator"></i> Tax Services <span class="badge badge-warning">NEW</span>
                            </a>
                            <button class="list-group-item list-group-item-action text-danger" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .app-container {
                padding-bottom: 60px; /* Space for fixed navigation */
            }

            .content-area {
                padding: 15px;
                max-width: 100%;
                overflow-x: hidden;
            }

            .section-title {
                color: #1a237e;
                font-size: 1.5rem;
                margin-bottom: 1rem;
                text-align: center;
            }

            /* Video Section */
            .video-container {
                width: 100%;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }

            /* Success Stories */
            .story-card {
                background: white;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                margin: 0 auto;
                max-width: 300px;
            }

            .story-card img {
                width: 100%;
                height: 150px;
                object-fit: cover;
            }

            .story-card .card-content {
                padding: 15px;
            }

            /* Funding Trends */
            .chart-container {
                background: white;
                padding: 15px;
                border-radius: 15px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                height: 300px;
            }

            /* Mentor Network */
            .mentor-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
                padding: 10px;
            }

            .mentor-card {
                background: white;
                padding: 15px;
                border-radius: 15px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                text-align: center;
            }

            /* Impact Metrics */
            .impact-grid {
                display: flex;
                justify-content: space-around;
                align-items: flex-end;
                height: 250px;
                padding: 20px 0;
            }

            .impact-item {
                text-align: center;
                width: 80px;
            }

            .impact-bar {
                width: 100%;
                border-radius: 8px;
                animation: growUp 1s ease-out;
            }

            .impact-label {
                margin-top: 10px;
                font-size: 14px;
                font-weight: bold;
            }

            @keyframes growUp {
                from { height: 0; }
                to { height: 100%; }
            }

            /* Fixed Navigation */
            .mobile-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                background: #1a237e;
                display: flex;
                justify-content: space-around;
                align-items: center;
                padding: 10px 0;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                z-index: 1000;
            }

            .mobile-nav-item {
                color: white;
                text-decoration: none;
                display: flex;
                flex-direction: column;
                align-items: center;
                font-size: 0.8rem;
            }

            .mobile-nav-item i {
                font-size: 1.2rem;
                margin-bottom: 4px;
            }

            .mobile-nav-item.active {
                background: rgba(255,255,255,0.1);
                padding: 5px 10px;
                border-radius: 8px;
            }

            /* Responsive Adjustments */
            @media (max-width: 576px) {
                .mentor-grid {
                    grid-template-columns: 1fr;
                }

                .impact-item {
                    width: 60px;
                }

                .section-title {
                    font-size: 1.2rem;
                }
            }

            /* Add styles for logout button */
            #logoutBtn {
                background: none;
                border: none;
                width: 100%;
                text-align: left;
                cursor: pointer;
                padding: 15px;
            }

            #logoutBtn:hover {
                background-color: #ffebee;
            }

            #logoutBtn i {
                margin-right: 10px;
                color: #dc3545;
            }

            .modal-backdrop {
                background-color: rgba(0,0,0,0.5);
            }
            
            .modal-content {
                border-radius: 15px;
                margin: 20px;
            }

            .list-group-item {
                border-left: none;
                border-right: none;
                padding: 15px;
                transition: background-color 0.3s;
            }

            .list-group-item i {
                margin-right: 10px;
                color: #1a237e;
            }
        </style>
        <script>
            // Function to show more menu
            function showMoreMenu() {
                $('#moreMenu').modal('show');
            }

            // Function to handle logout
            function handleLogout() {
                console.log('Logging out...');
                
                // Show confirmation dialog
                if (confirm('Are you sure you want to logout?')) {
                    try {
                        // Clear all user data
                        localStorage.removeItem('userLoggedIn');
                        localStorage.removeItem('user');
                        localStorage.removeItem('savedUser');
                        
                        // Hide the modal
                        $('#moreMenu').modal('hide');
                        
                        // Force reload the login page
                        setTimeout(() => {
                            window.location.replace('login.html');
                        }, 300);
                    } catch (error) {
                        console.error('Logout error:', error);
                        alert('Error during logout. Please try again.');
                    }
                }
            }

            // Initialize funding trends chart
            function initializeFundingChart() {
                const ctx = document.getElementById('fundingChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Funding (in Millions)',
                            data: [12, 19, 15, 25, 22, 30],
                            borderColor: '#1a237e',
                            backgroundColor: 'rgba(26, 35, 126, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Initialize success stories carousel
            function initializeCarousel() {
                $('#successCarousel').carousel({
                    interval: 3000,
                    ride: 'carousel'
                });
            }

            // Function to animate impact metrics
            function animateImpactMetrics() {
                const bars = document.querySelectorAll('.impact-bar');
                bars.forEach(bar => {
                    const height = bar.style.height;
                    bar.style.height = '0';
                    setTimeout(() => {
                        bar.style.height = height;
                    }, 100);
                });
            }

            // Wait for the device to be ready
            document.addEventListener('deviceready', onDeviceReady, false);

            // Single function to check authentication
            function checkAuthentication() {
                const userLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
                const userData = localStorage.getItem('user');
                
                if (!userLoggedIn || !userData) {
                    console.log('User not logged in or session expired');
                    return false;
                }

                try {
                    // Validate user data
                    const user = JSON.parse(userData);
                    if (!user.username || !user.role || !user.email) {
                        console.log('Invalid user data');
                        localStorage.removeItem('userLoggedIn');
                        localStorage.removeItem('user');
                        return false;
                    }
                    return true;
                } catch (error) {
                    console.error('Error validating user data:', error);
                    localStorage.removeItem('userLoggedIn');
                    localStorage.removeItem('user');
                    return false;
                }
            }

            function onDeviceReady() {
                console.log('Running cordova-' + cordova.platformId + '@' + cordova.version);

                // Check authentication only once
                if (!checkAuthentication()) {
                    // Use replace to prevent back navigation
                    window.location.replace('login.html');
                    return;
                }

                try {
                    const userData = JSON.parse(localStorage.getItem('user'));

                    // Initialize components
                    initializeFundingChart();
                    initializeCarousel();
                    animateImpactMetrics();

                    // Display user info
                    const welcomeText = document.querySelector('.welcome-section h1');
                    if (welcomeText && userData.username) {
                        welcomeText.textContent = `Welcome, ${userData.username}`;
                    }

                    // Logout button click handler
                    const logoutBtn = document.getElementById('logoutBtn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', handleLogout);
                    }

                    // Handle back button
                    document.addEventListener("backbutton", onBackKeyDown, false);
                } catch (error) {
                    console.error('Error initializing app:', error);
                    // If there's an error, redirect to login
                    window.location.replace('login.html');
                }
            }

            function onBackKeyDown(e) {
                if ($('#moreMenu').hasClass('show')) {
                    e.preventDefault();
                    $('#moreMenu').modal('hide');
                } else if (window.location.href.includes('index.html')) {
                    e.preventDefault();
                    if (confirm('Do you want to exit the app?')) {
                        navigator.app.exitApp();
                    }
                } else {
                    navigator.app.backHistory();
                }
            }

            // Initialize bottom nav active state
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    if (!this.getAttribute('onclick')) {  // Don't add active class to More button
                        document.querySelectorAll('.mobile-nav-item').forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });

            // Make sure jQuery and Bootstrap are loaded
            $(document).ready(function() {
                // Initialize all modals
                $('.modal').modal({
                    show: false
                });

                // Initialize components if device is not ready yet
                if (!cordova.platformId) {
                    if (!checkAuthentication()) {
                        window.location.replace('login.html');
                        return;
                    }

                    // Initialize components
                    if (!Chart.instances.length) {
                        initializeFundingChart();
                    }
                    initializeCarousel();
                    animateImpactMetrics();
                }

                // Add click handler for logout button using jQuery
                $('#logoutBtn').on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    handleLogout();
                });
            });
        </script>
    </body>
</html>